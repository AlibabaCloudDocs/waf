# 自定义规则组 {#concept_j4x_f35_1gb .concept}

通过自定义规则组，您可以查看并自由组合Web应用防火墙（WAF）的内置防护规则，生成有针对性的防护策略（规则组），并在相应防护功能中应用该策略。

**说明：** 该功能仅支持企业版或旗舰版的包年包月WAF实例。目前，仅支持自定义Web应用攻击防护的防护策略。关于Web应用攻击防护的默认策略，请参考[Web应用攻击防护](intl.zh-CN/用户指南/防护配置/Web应用攻击防护.md#)。

## 查看内置规则集 {#section_pwd_z45_1gb .section}

在使用自定义规则组前，建议您查看并熟悉Web应用防火墙的内置防护规则集。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**或**海外地区**。
3.  在**设置** \> **自定义规则组**页面，选择要操作的防护功能页签（目前仅支持**Web攻击防护**）。
4.  单击**内置规则集**页签，查看WAF所有内置的Web攻击防护规则。每条规则包含以下信息：

    -   **规则**：该规则的名称。
    -   **规则ID**：该规则的唯一标识ID。
    -   **危险等级**：该规则防御的Web攻击的危险等级，包括高危、中危、低危。
    -   **应用类型**：该规则防护的Web应用类型，包括通用、Wordpress、Discuz、Tomcat、phpMyAdmin等。
    -   **防护类型**：该规则防御的Web攻击类型，包括SQL注入、跨站脚本、代码执行、CRLF、本地文件包含、远程文件包含、webshell、CSRF、其它。
    -   **规则描述**：该规则防御的Web攻击的信息、要检测的命令，以及在哪些选择器上执行检测等。

        **说明：** 将鼠标悬停在一个规则描述上可以看到完整的描述信息。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/77901/154459903133856_zh-CN.png)

5.  （可选）使用筛选和搜索功能定位到指定的规则。
    -   支持通过防护类型、应用类型、危险等级筛选规则。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/77901/154459903133857_zh-CN.png)

    -   支持通过规则名称/ID搜索规则。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/77901/154459903133858_zh-CN.png)


## 添加自定义规则组 {#add .section}

您可以为指定防护功能添加自定义防护规则组。添加自定义规则组时，您为该规则组自由搭配WAF支持的内置防护规则，形成有针对性的防护策略。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**或**海外地区**。
3.  在**设置** \> **自定义规则组**页面，选择要添加自定义规则组的防护功能页签（目前仅支持**Web攻击防护**）。

    自定义规则组页签下罗列了所有Web攻击防护规则组，其中规则组ID **1012**、**1011**、**1013**为默认的Web攻击防护策略。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/77901/154459903133853_zh-CN.png)

4.  新建一个规则组，或者复制已有规则组生成一个新的规则组。

    **说明：** 您最多可以添加10条自定义Web攻击防护规则组。

    -   新建规则组
        1.  单击**添加规则组**。
        2.  在添加规则组页面，完成以下配置。
            -   **规则组名称**：必填，该名称会显示在防护策略配置下拉框中。建议您使用有明确含义的名称。
            -   **规则描述**：选填，添加关于该规则的说明。
            -   **规则**：从左侧所有Web攻击防护规则集中选择要添加到右侧该规则组中的规则。

                关于规则信息的含义，请参考[查看内置规则集步骤4](#)。您也可以使用筛选和搜索功能定位到指定的规则，具体请参考[查看内置规则集步骤5](#)。

        3.  单击**确定**，完成规则组添加。

            自定义规则组中出现新添加的规则组，系统已为其分配唯一的规则组ID。

    -   复制已有规则组
        1.  定位到要复制的规则组，单击其操作列下的**复制**。
        2.  在添加规则组页面，重新设置一个**规则组名称**，并确认规则组信息（不支持调整规则组内的规则）。
        3.  单击**确认**，完成复制添加。

            自定义规则组中出现复制添加的规则组，系统已为其分配唯一的规则组ID。您可以参照[编辑自定义规则组](#)，进一步调整规则组内的规则。


## 应用自定义规则组 {#apply .section}

已添加自定义规则组后，您可以在具体网站的防护配置中应用/解除应用自定义规则组，或者在自定义规则组页面批量对网站应用自定义规则组。

**操作步骤**

以Web攻击防护为例，参照以下步骤，在网站配置中应用/解除应用自定义规则组：

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**或**海外地区**。
3.  在**管理** \> **网站配置**页面，选择要操作的域名，并单击其操作列下的**防护配置**。
4.  在**Web应用攻击防护**下，开启防护。
5.  打开**防护规则策略**下拉框，根据规则名称选择新添加的自定义规则（本示例中为**custom**）。

    如果您希望解除应用自定义规则组，只需在**防护规则策略**下拉框中选择一个默认策略（宽松规则、中等规则、严格规则）。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/77901/154459903133861_zh-CN.png)


以Web攻击防护为例，参照以下步骤，批量应用自定义规则组：

**说明：** 如果需要解除应用自定义规则组，建议您到具体网站的防护配置页面进行操作。

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**或**海外地区**。
3.  在**设置** \> **自定义规则组**页面，选择要操作的防护功能页签（目前仅支持**Web攻击防护**）。
4.  在自定义规则组页签下，选择要操作的自定义规则组，单击其操作列下的**应用到网站**。
5.  勾选需要应用该规则组的网站，单击**确认**，完成配置。

    支持搜索指定域名。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/77901/154459903133864_zh-CN.png)


## 编辑自定义规则组 {#edit .section}

已添加自定义规则组后，您可以调整其包含的规则以及规则组名称和描述信息。默认规则组不支持编辑。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**或**海外地区**。
3.  在**设置** \> **自定义规则组**页面，选择要操作的防护功能页签（目前仅支持**Web攻击防护**）。
4.  选择要操作的规则组，单击其操作列下的**编辑**。
5.  在编辑规则组页面，调整规则配置信息。具体请参考[新建规则组](#)。
6.  单击**确认**，完成编辑。

## 删除自定义规则组 {#delete .section}

对于不再需要的自定义规则组，您可以将其删除。删除自定义规则组前，应确保该规则组未被应用到网站上。默认规则不支持删除。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**或**海外地区**。
3.  在**设置** \> **自定义规则组**页面，选择要操作的防护功能页签（目前仅支持**Web攻击防护**）。
4.  选择要删除的规则组，单击其操作列下的**删除**。
5.  在提示对话框中，单击**确认**，完成删除。

    **说明：** 如果该规则组被应用到网站上，您必须先解除应用，才能删除该规则组。具体操作请参考[应用自定义规则组](#)。



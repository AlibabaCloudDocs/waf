# 网站配置 {#concept_pym_brk_5fb .concept}

网站配置指在Web应用防火墙（WAF）控制台上配置启用WAF防护的网站的转发信息。本文介绍通过DNS配置模式接入WAF时，如何添加和管理网站配置。

**说明：** 如果您的源站服务器部署在阿里云ECS（华北地区），且ECS实例拥有公网IP或已绑定弹性公网IP（EIP），您也可以使用透明代理模式接入WAF。

-   透明代理模式：将所配置的源站服务器公网IP的80端口接收到的HTTP协议的流量直接牵引到WAF，经WAF处理后再将正常的访问流量回注给源站服务器。

    该方式需要您授权WAF读取您的ECS实例信息。配置过程中只用在WAF控制台添加域名和勾选相应的服务器IP。具体操作请参考[使用透明代理模式接入WAF](intl.zh-CN/用户指南/使用透明代理模式接入WAF.md#)。

-   DNS配置模式：通过修改域名解析的方式，将被防护域名的访问流量指向WAF；WAF根据域名配置的源站服务器地址，将处理后的请求转发回源站服务器。

    该方式需要您在WAF控制台添加网站配置并更新域名的DNS设置。


使用DNS配置模式接入WAF时，您可以选择[自动添加网站配置](#)或[手动添加网站配置](#)。

-   自动添加网站配置。添加网站配置时，WAF可以自动读取[阿里云云解析DNS控制台](https://dns.console.aliyun.com)中的解析A记录，获取网站域名和源站服务器IP地址，帮助您自动添加网站配置。自动添加网站配置后，WAF也会自动更新域名的解析记录，完成网站接入。
-   手动添加网站配置。如果域名的DNS解析没有托管在阿里云云解析DNS上，您只能手动添加网站配置，并在域名的DNS服务商处手动修改DNS解析，将网站收到的Web请求转发至WAF进行监控 ，完成网站接入。

    关于手动修改DNS解析的方法，请参考[业务接入WAF配置](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/业务接入WAF配置.md#)。


**说明：** 允许添加的网站配置数量由WAF实例规格和扩展域名包数量决定，具体请参考[扩展域名包](../intl.zh-CN/产品定价/开通WAF/扩展域名包.md#)。

如果网站配置中的源站服务器地址、服务协议、端口等信息发生变化，或者您需要调整HTTPS高级设置功能，您可以[编辑网站配置](#)。

对于不再需要WAF防护的域名，您可以在恢复其DNS解析后，[删除网站配置](#)。

## 自动添加网站配置 {#auto-website-configuration .section}

**前提条件**

-   要防护的网站的DNS解析托管在阿里云云解析DNS，且其解析记录中存在至少一条生效的A记录。

    如果您暂时无法使用阿里云云解析DNS，建议您参考[网站配置](../intl.zh-CN/用户指南/使用DNS配置模式接入WAF/网站配置.md#) ，手动添加网站配置。

-   （仅针对中国大陆地域）网站已经通过中华人民共和国工业和信息化部ICP备案。
-   （仅针对网站支持HTTPS协议）获取网站的HTTPS证书和私钥文件，或者已将证书托管在阿里云证书服务。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**、**海外地区**。
3.  前往**管理** \> **网站配置**页面，选择**DNS配置模式**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15546/155323397340172_zh-CN.png)

4.  单击**添加网站**。

    WAF自动罗列出当前阿里云账号在云解析DNS中已添加过解析A记录的域名。如果云解析DNS中无任何解析A记录，则请选择您的域名页面不会出现，建议您参考[网站配置](../intl.zh-CN/用户指南/使用DNS配置模式接入WAF/网站配置.md#)，手动添加网站配置。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15546/15532339737562_zh-CN.png)

5.  在请选择您的域名页面勾选要防护的**域名**及**协议类型**。
6.  如果协议类型包括**HTTPS**，您必须先完成证书验证，才能添加网站。

    **说明：** 您也可以先不勾选**HTTPS**，在完成网站配置后，参考[更新HTTPS证书](../intl.zh-CN/用户指南/使用DNS配置模式接入WAF/更新HTTPS证书.md#)上传证书。

    1.  单击**验证证书**。
    2.  在验证证书对话框中上传证书和私钥文件。

        -   如果您已将网站的证书托管在[阿里云证书服务控制台](https://yundunnext.console.aliyun.com/?p=casnext)，则可以在验证证书对话框中单击**选择已有证书**，并选择一个与要防护的域名绑定的证书。
        -   手动上传证书。单击**手动上传**，填写**证书名称**，并将该域名所绑定的证书文件和私钥文件中的文本内容分别复制粘贴到**证书文件**和**私钥文件**文本框中。

            更多信息，请参考[更新HTTPS证书](../intl.zh-CN/用户指南/使用DNS配置模式接入WAF/更新HTTPS证书.md#)。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15546/15532339737567_zh-CN.png)

    3.  单击**验证**，完成证书验证。
7.  单击**立即自动添加网站**。

    自动添加网站后，WAF将自动为您更新该域名的DNS CNAME解析记录，将网站Web请求转发到WAF进行监控。一键添加及解析的过程一般需要10-15分钟。

    **说明：** 如果您收到提示，需要手动更新DNS解析记录，请参照[步骤2：修改DNS解析](../intl.zh-CN/快速入门/步骤2：修改DNS解析.md#)完成WAF接入。

8.  在**管理** \> **网站配置**页面查看新添加的域名及其**DNS解析状态**。
    -   DNS解析状态正常表示该网站已正常接入WAF。您可以参照[步骤3：配置WAF防护策略](../intl.zh-CN/快速入门/步骤3：配置WAF防护策略.md#)，完成后续任务。
    -   刚添加完网站配置后，该域名的DNS解析状态也可能显示为**异常**。建议您稍等一会儿再来查看，或者在DNS供应商处检查域名的DNS设置。

        如果DNS设置不正确，请参考[步骤2：修改DNS解析](../intl.zh-CN/快速入门/步骤2：修改DNS解析.md#)。关于DNS解析状态的判断标准，请参考[DNS解析状态说明](../intl.zh-CN/常见问题/DNS解析状态异常.md#)。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15546/15532339737570_zh-CN.png)


## 手动添加网站配置 {#manual-website-configuration .section}

**前提条件**

-   获取要防护的网站的域名。
-   获取网站的源站服务器地址。
-   确认网站是否已接入或需要接入CDN、高防IP等其它代理型系统。
-   （仅针对中国大陆地域）网站已经通过中华人民共和国工业和信息化部ICP备案。
-   （仅针对网站支持HTTPS协议）获取网站的HTTPS证书和私钥文件，或者已将证书托管在阿里云证书服务。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**、**海外地区**。
3.  前往**管理** \> **网站配置**页面，选择**DNS配置模式**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/63401/155323397340154_zh-CN.png)

4.  单击**添加网站**。

    WAF自动罗列出当前阿里云账号在云解析DNS中已添加过解析A记录的域名。如果云解析DNS中无任何解析A记录，则请选择您的域名页面不会出现。

5.  在请选择您的域名页面，单击**手动添加其它网站**。
6.  在填写网站信息任务中，完成以下配置。

    |配置项|配置说明|
    |---|----|
    |**域名**|填写要防护的域名。**说明：** 

    -   支持填写泛域名，如`*.aliyun.com`。WAF将自动匹配该泛域名对应的子域名。
    -   如果同时存在泛域名和精确域名配置（如`*.aliyun.com`和`www.aliyun.com`），WAF优先使用精确域名所配置的转发规则和防护策略。
    -   暂不支持添加.edu域名。如果您需要添加.edu域名，请提交工单联系售后技术支持。
|
    |**协议类型**|勾选网站支持的协议类型，可选值：**HTTP**、**HTTPS**。**说明：** 

    -   如果网站支持HTTPS加密认证，请勾选HTTPS，并在添加网站后参考[更新HTTPS证书](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/更新HTTPS证书.md#)上传证书和私钥文件。
    -   勾选HTTPS后，可使用**高级设置**实现HTTP强制跳转和HTTP回源等功能，保证访问平滑。更多信息，请参考[HTTPS高级设置](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/HTTPS高级配置.md#)。
|
    |**服务器地址**|填写网站的源站服务器地址，支持IP地址和其它地址格式。网站接入WAF后，WAF将过滤后的访问请求转发至该地址。    -   （推荐）勾选**IP**，并填写源站服务器的公网IP地址（如云服务器ECS实例的IP、负载均衡SLB实例的IP等）。

**说明：** 

        -   多个地址间以逗号分隔。最多支持添加20个源站IP。
        -   如果配置多个IP地址，WAF将在这些地址间自动进行健康检查和负载均衡。更多信息，请参考[源站负载均衡](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/WAF源站负载均衡.md#)。
    -   勾选**其它地址**，填写服务器回源域名（如对象存储OSS的CNAME等）。

**说明：** 

        -   服务器回源域名不应和要防护的网站域名相同。
        -   如果您的源站服务器地址为OSS域名，在WAF控制台中完成域名接入配置后，需要在OSS控制台中为该OSS域名绑定自定义域名，具体操作请参考[管理域名](../../../../../../intl.zh-CN/控制台用户指南/管理存储空间/管理域名/绑定自定义域名.md#)。
|
    |**服务器端口**|配置网站的协议端口。网站接入WAF后，WAF将过滤后的访问请求转发至该端口。    -   勾选HTTP协议后，默认HTTP端口为**80**。
    -   勾选HTTPS协议后，默认HTTPS端口为**443**。
    -   如果要使用其它端口，单击**自定义**进行添加。

**说明：** 关于WAF支持的非标准端口说明，请参考[非标准端口说明](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/非标端口支持.md#)。

**说明：** 配置的协议和端口必须与您所接入的网站业务源站IP（在WAF中配置的服务器IP地址）的协议和端口（在WAF中配置的服务器端口）一致，不支持端口转换功能。

|
    |**WAF前是否有七层代理（高防/CDN等）**|根据该网站业务的实际情况勾选。如果在WAF前需要配置其它七层代理进行转发，请务必勾选**是**，否则WAF将无法获取访问该网站的客户端真实IP。|
    |**负载均衡算法**|如果配置了多个源站IP，勾选**IP hash**或**轮询**。WAF将根据所选择的方式在多个源站IP间分发访问请求，实现负载均衡。|
    |**流量标记**|填写一个空闲的**Header字段名称**和自定义**Header字段值**，用来标识经过WAF转发到源站的Web请求。流量经过WAF后，WAF在请求中添加此处指定的字段，方便您的后端服务统计信息。**说明：** 如果Web请求中本身包含此处定义的头部字段，WAF将用此处的设定值覆盖原Web请求中对应字段的内容。

|

7.  完成配置后，单击**下一步**，成功添加网站配置。

    成功添加网站配置后，您可以选择执行以下任务：

    -   根据页面提示，完成**修改DNS解析**任务。具体操作请参考[业务接入WAF配置](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/业务接入WAF配置.md#)。
    -   （已勾选HTTPS协议）上传网站HTTPS证书和私钥。具体操作请参考[更新HTTPS证书](intl.zh-CN/用户指南/使用DNS配置模式接入WAF/更新HTTPS证书.md#)。
    -   回到**管理** \> **网站配置**页面，查看新添加的网站配置，根据需要进行**编辑**或**删除**。

## 编辑网站配置 {#edit-website-configuration .section}

已添加的网站配置若发生变化，例如源站服务器地址、协议类型（高级HTTPS功能）、监听端口等变化，您可以编辑网站配置。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**、**海外地区**。
3.  前往**管理** \> **网站配置**页面，在**DNS配置模式**下，选择要操作的网站配置，单击其操作列下的**编辑**。
4.  在编辑页面，参考[手动添加网站步骤6](#)，修改相应配置。

    **说明：** **域名**不支持调整。若要防护其他域名，建议您新增一个网站配置，并删除不需要的网站配置。

5.  单击**确定**，成功编辑网站配置。

## 删除网站配置 {#delete-website-configuration .section}

若网站不再需要WAF防护，您可以先恢复其DNS解析（即将DNS指回服务器源站IP），然后删除网站配置。

**操作步骤**

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。
2.  在页面上方选择地域：**中国大陆**、**海外地区**。
3.  前往**管理** \> **网站配置**页面，在**DNS配置模式**下，选择要删除的网站配置，单击其操作列下的**删除**。

    **说明：** 确认删除前，请先恢复网站DNS解析；否则在删除配置后，该域名的流量将无法正常转发。

4.  在提示信息对话框中，单击**确定**，成功删除网站配置。


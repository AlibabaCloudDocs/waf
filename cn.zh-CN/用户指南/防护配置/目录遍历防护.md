# 目录遍历防护 {#task_qy2_3gq_dhb .task}

目录遍历防护帮助您自动封禁在短时间内进行多次目录遍历攻击的客户端IP。

只有同时满足以下条件时，才能开启目录遍历防护：

-   使用包年包月模式开通Web应用防火墙（WAF），或者使用按量付费模式开通Web应用防火墙并且开启Web攻击防护高级防护。具体请参考[开通Web应用防火墙](../../../../../cn.zh-CN/产品定价/开通WAF/开通Web应用防火墙.md#)、[功能与规格配置（按量付费模式）](cn.zh-CN/用户指南/设置/功能与规格配置（按量付费模式）.md#)。
-   网站已接入WAF进行防护。具体请参考[WAF功能使用概览接入WAF部分](cn.zh-CN/用户指南/WAF功能使用概览.md#implement)。
-   已开启Web应用攻击防护和CC安全防护功能。具体请参考[Web应用攻击防护](cn.zh-CN/用户指南/防护配置/Web应用攻击防护.md#)和[CC安全防护](cn.zh-CN/用户指南/防护配置/CC安全防护.md#)。

您可以开启目录遍历防护功能，使WAF自动检测并封禁在短时间内进行多次目录遍历攻击的客户端IP；被封禁IP在封禁时间内的请求将被直接拦截，封禁时间过后自动解除封禁。开启防护后，您可以自定义防护策略（见步骤5）；也可以一键解除已封禁的客户端IP（见步骤6）。

1.  登录[云盾Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)。 
2.  前往**管理** \> **网站配置**页面，并在页面上方选择WAF所在地区（中国大陆、海外地区）。 
3.  选择要操作的域名，单击其操作列下的**防护配置**。 
4.   在**目录遍历防护**下，开启防护。![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/145405/155349990641169_zh-CN.png)

 成功开启目录遍历防护后，默认启用的防护策略为：当WAF检测到某个客户端IP在10秒总请求次数超过50次，且响应码404占比超过总请求的70%，则封禁该IP的访问请求1,800秒。
5.  如果您想自定义防护策略，请参照以下步骤进行操作： 
    1.  在**目录遍历防护**下，单击**前去配置**。 
    2.  在规则设置对话框中，完成以下配置。 

        **说明：** 如果您不清楚如何设置，请在**设置参考**下单击选择一种模式：**宽松模式**、**严格模式**、**正常模式**。每种模式对应不同严格程度的策略，您可以在其基础上进行调整。

        |配置|描述|
        |--|--|
        |**检测时间范围**|设置检测时间间隔，单位为秒。|
        |**请求总数超过**|设置在检测时间范围内，客户端发起多少次以上访问请求，且这些请求中404响应码的占比超过多少（%），则触发封禁。|
        |**且404响应码占比超过**|
        |**封禁IP**|设置触发封禁时，封禁客户端IP多长时间，单位为秒。|

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/145405/155349990641506_zh-CN.png)

    3.  单击**确定**。 
6.  如果您想手动解除已被封禁的客户端IP，在**目录遍历攻击**下，单击**解封当前封禁IP**。 


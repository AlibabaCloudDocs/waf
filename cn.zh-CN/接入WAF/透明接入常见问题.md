# 透明接入常见问题

## 同一个域名是否支持使用透明接入和CNAME接入两种模式？

不支持。

每个域名只能使用透明接入或CNAME接入两种方式之一。如果您已通过CNAME接入开启WAF防护的域名，需要切换为透明接入，您必须先删除该域名的CNAME接入配置，然后在透明接入模式下重新接入该域名。

**说明：** 域名首次透明接入WAF时，可能会导致该域名指向的网站Web业务出现秒级闪断。

## 已透明接入的域名如果无需WAF转发流量和提供防护，该如何处理？

如果您确认该域名无需WAF继续提供防护，您可以在WAF控制台**资产中心** \> **网站接入**页面的域名列表中，定位该域名所在的源站IP，删除该域名接入透明模式时绑定的所有端口、或者直接删除该域名即可。操作完成后，该域名的访问流量将切回到域名所在的源站服务器，不再通过WAF转发。

## 透明接入后，源站可以获取客户端的真实IP吗？

可以的。WAF会向域名所在的服务器直接提供真实的客户端IP，而不再将WAF的回源IP地址返回给源站服务器。

## 端口绑定的证书更新后，是否需要将证书重新上传到WAF透明接入模块中？

需要。

您可以参照以下步骤进行处理：

1.  将该更新的证书重新上传到[SSL证书控制台](https://yundunnext.console.aliyun.com/?p=cas)。相关内容请参见[上传证书](/cn.zh-CN/证书管理/上传证书.md)。
2.  将该证书重新上传到[负载均衡管理控制台](https://slb.console.aliyun.com/slb/cn-hangzhou)证书管理页面。
3.  在WAF控制台透明接入模块，单击**SLB/ALB**列表右上角![刷新](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5356623061/p175300.png)图标，同步SLB证书配置。

## 同一个域名如果配置到了多个SLB实例上，我需要如何完成透明接入？

这种情况下，您需要在对该域名进行透明接入配置时，同时添加这几个SLB实例的HTTP/HTTPS服务端口，实现WAF对这几个实例同时引流。

如果配置透明接入时，您仅添加了其中一个SLB实例的HTTP/HTTPS服务端口，WAF将仅转发来自该端口的访问流量并对其进行防护。来自其他SLB实例的流量将不会通过WAF转发和受到WAF的防护。

## 一个SLB实例配置了多个域名，如果我只对其中一个域名完成了透明接入，会有什么影响？

这种情况下，如果您只对其中一个域名进行透明接入，那么另外几个域名的访问流量会通过WAF转发，但不会受到WAF的防护。通过WAF转发的流量都会计入您消耗的业务带宽中。

## 透明接入时为什么看不到SLB实例？

透明接入存在一定的限制条件。具体内容，请参见[SLB透明接入](/cn.zh-CN/接入WAF/SLB透明接入.md)。

以下情况下，您可能在透明接入时看不到您的SLB公网实例：

|原因|说明|解决方法|
|--|--|----|
|公网SLB实例位于华北2（北京）、华东1（杭州）、华东2（上海）、华南1（深圳）或西南1（成都）以外的地域。|目前，仅支持位于上述地域的公网SLB实例使用透明接入模式。|使用位于华北2（北京）、华东1（杭州）、华东2（上海）、华南1（深圳）或西南1（成都）地域的公网SLB实例接入WAF。|
|公网SLB实例绑定的公网IP是IPv6版本。|透明接入不支持IPv6版本的公网SLB实例。|使用IPv4版本的公网SLB实例接入WAF。|
|公网SLB实例中未配置HTTP/HTTPS监听协议。|目前，WAF仅支持通过HTTP/HTTPS端口执行透明接入。如果您的SLB实例中仅配置了四层协议，也是无法支持透明接入模式的。|使用配置了HTTP/HTTPS监听的公网SLB实例接入WAF。|
|原有的公网SLB实例位于历史网络架构中的经典网络。|目前，仅支持已完成公网上移网络改造的SLB接入WAF。如果您的SLB满足其他条件但未出现透明接入列表中，可能是由于您当前的SLB未完成公网上移改造。|使用VPC+EIP的网络结构的SLB实例或新购公网SLB实例（新购买的公网SLB实例不存在历史网络架构中的问题）接入WAF。|
|透明接入时，需要配置的端口使用的证书未上传到阿里云[SSL证书控制台](https://yundunnext.console.aliyun.com/?p=cas)进行统一管理。|公网SLB实例接入WAF时，需要配置的端口如果为HTTPS协议，但是该端口使用的证书未上传到阿里云SSL证书服务中，会导致SLB无法将该证书自动同步到WAF中，您将无法完成网站接入。|将该公网SLB实例HTTPS端口使用的证书上传到[SSL证书控制台](https://yundunnext.console.aliyun.com/?p=cas)。|
|接入WAF的公网SLB实例端口开启了双向认证。|如果当前HTTPS协议在公网SLB中采用了双向认证，则暂时不支持透明接入。|需要在SLB控制台取消双向认证选项后，重新在[Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)执行透明接入。|
|需要执行透明接入的公网SLB是新购的SLB实例。|新购买的SLB实例存在有一定的数据延迟，您可能在透明接入页面暂时无法看到新购买的SLB实例。|完成SLB购买后，建议您等待1~3分钟，再刷新[Web应用防火墙控制台](https://yundun.console.aliyun.com/?p=waf)后执行透明接入。|

